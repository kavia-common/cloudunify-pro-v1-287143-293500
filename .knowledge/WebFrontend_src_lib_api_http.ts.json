{"is_source_file": true, "format": "TypeScript", "description": "This file defines a TypeScript module for handling HTTP API requests in a web application. It includes functions to retrieve API and WebSocket base URLs, configure authentication tokens, handle token refresh, and perform HTTP requests with automatic retry on authorization failures.", "external_files": ["fetch"], "external_methods": ["fetch", "new URL", "URL.protocol", "URL.host", "URL.pathname", "String.prototype.trim", "String.prototype.replace", "Promise.prototype.finally"], "published": ["getApiBaseUrl", "getWsBaseUrl", "configureAuth", "httpRequest"], "classes": [], "methods": [{"name": "function readViteApiBase(): string { readViteApiBase", "description": "Retrieves and sanitizes the API base URL from environment variables.", "scope": "", "scopeKind": ""}, {"name": "function readViteWsBase(): string | null { readViteWsBase", "description": "Retrieves and sanitizes the WebSocket base URL from environment variables.", "scope": "", "scopeKind": ""}, {"name": "export function getApiBaseUrl(): string { getApiBaseUrl", "description": "Returns the configured API base URL.", "scope": "", "scopeKind": ""}, {"name": "export function getWsBaseUrl(): string { getWsBaseUrl", "description": "Returns the WebSocket base URL, derived from environment variables or by transforming the API base URL.", "scope": "", "scopeKind": ""}, {"name": "export function configureAuth(params: { configureAuth", "description": "Sets up authentication token retrieval, refresh, and unauthorized handlers.", "scope": "", "scopeKind": ""}, {"name": "async function attemptRefresh(): Promise<boolean> { attemptRefresh", "description": "Attempts to refresh the authentication token if a refresh handler is configured.", "scope": "", "scopeKind": ""}, {"name": "function shouldSkipRefresh(path: string): boolean { shouldSkipRefresh", "description": "Determines whether URL paths should skip token refresh logic.", "scope": "", "scopeKind": ""}, {"name": "export async function httpRequest<T>( httpRequest", "description": "Performs an HTTP request with automatic token handling, retries on 401 errors, and detailed error reporting.", "scope": "", "scopeKind": ""}], "calls": ["getApiBaseUrl", "fetch", "new URL", "attemptRefresh", "unauthorizedHandler", "shouldSkipRefresh"], "search-terms": ["TypeScript HTTP client", "VITE_API_BASE", "token refresh", "WebSocket URL derivation", "auth configuration"], "state": 2, "file_id": 36, "knowledge_revision": 144, "git_revision": "", "revision_history": [{"83": ""}, {"92": ""}, {"144": ""}], "ctags": [{"_type": "tag", "name": "HttpMethod", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export type HttpMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "api", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const api = getApiBaseUrl();$/", "language": "TypeScript", "kind": "constant", "scope": "getWsBaseUrl", "scopeKind": "function"}, {"_type": "tag", "name": "attemptRefresh", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function attemptRefresh(): Promise<boolean> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const base = (import.meta as any).env?.VITE_API_BASE as string | undefined;$/", "language": "TypeScript", "kind": "constant", "scope": "readViteApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const base = getApiBaseUrl();$/", "language": "TypeScript", "kind": "constant", "scope": "httpRequest", "scopeKind": "function"}, {"_type": "tag", "name": "basePath", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const basePath = u.pathname && u.pathname !== '\\/' ? u.pathname.replace(\\/\\\\\\/+$\\/, '') : '';$/", "language": "TypeScript", "kind": "constant", "scope": "getWsBaseUrl", "scopeKind": "function"}, {"_type": "tag", "name": "configureAuth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function configureAuth(params: {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "errText", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const errText = await res.text();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "explicit", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const explicit = readViteWsBase();$/", "language": "TypeScript", "kind": "constant", "scope": "getWsBaseUrl", "scopeKind": "function"}, {"_type": "tag", "name": "getAccessToken", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let getAccessToken: () => string | null = () => null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "getApiBaseUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function getApiBaseUrl(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getWsBaseUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function getWsBaseUrl(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const headers: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "httpRequest", "scopeKind": "function"}, {"_type": "tag", "name": "httpRequest", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export async function httpRequest<T>($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const message = `API ${method} ${path} failed: ${res.status} ${res.statusText} - ${errText}`;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const p = path.toLowerCase();$/", "language": "TypeScript", "kind": "constant", "scope": "shouldSkipRefresh", "scopeKind": "function"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const url = `${base}${path.startsWith('\\/') ? path : `\\/${path}`}`;$/", "language": "TypeScript", "kind": "constant", "scope": "httpRequest", "scopeKind": "function"}, {"_type": "tag", "name": "readViteApiBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function readViteApiBase(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "readViteWsBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function readViteWsBase(): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "refreshHandler", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let refreshHandler: (() => Promise<boolean>) | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "refreshPromise", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let refreshPromise: Promise<boolean> | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "refreshed", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const refreshed = await attemptRefresh();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "httpRequest", "scopeKind": "function"}, {"_type": "tag", "name": "shouldSkipRefresh", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function shouldSkipRefresh(path: string): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const text = await res.text();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = getAccessToken?.();$/", "language": "TypeScript", "kind": "constant", "scope": "httpRequest", "scopeKind": "function"}, {"_type": "tag", "name": "trimmed", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const trimmed = String(ws).trim();$/", "language": "TypeScript", "kind": "constant", "scope": "readViteWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const u = new URL(api, (typeof window !== 'undefined' ? window.location.origin : 'http:\\/\\/loc/", "language": "TypeScript", "kind": "constant", "scope": "getWsBaseUrl", "scopeKind": "function"}, {"_type": "tag", "name": "unauthorizedHandler", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let unauthorizedHandler: (() => void) | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const url = `${base}${path.startsWith('\\/') ? path : `\\/${path}`}`;$/", "language": "TypeScript", "kind": "constant", "scope": "httpRequest", "scopeKind": "function"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const ws = (import.meta as any).env?.VITE_WS_URL as string | undefined;$/", "language": "TypeScript", "kind": "constant", "scope": "readViteWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "wsProtocol", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const wsProtocol = u.protocol === 'https:' ? 'wss:' : 'ws:';$/", "language": "TypeScript", "kind": "constant", "scope": "getWsBaseUrl", "scopeKind": "function"}], "hash": "20501adeb13470cbadc2c733f2f8f314", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/http.ts", "fields": [{"name": "let getAccessToken: () => string | null = () => null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let refreshHandler: (() => Promise<boolean>) | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let refreshPromise: Promise<boolean> | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let unauthorizedHandler: (() => void) | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}]}