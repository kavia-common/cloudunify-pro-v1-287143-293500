{"is_source_file": true, "format": "TypeScript", "description": "This file provides an HTTP client wrapper for making API requests, including features like base URL configuration, authorization token handling, automatic token refresh on 401 errors, error handling, and support for JSON request/response. It also includes utility functions for deriving WebSocket base URLs and allows external configuration via 'configureAuth'.", "external_files": ["../../types/api"], "external_methods": [], "published": ["http", "configureAuth", "deriveWsBase"], "classes": [], "methods": [{"name": "function buildUrl(path: string, query?: Record<string, unknown>): string { buildUrl", "description": "Constructs a full URL from a base and relative path, including optional query parameters.", "scope": "", "scopeKind": ""}, {"name": "async function parseJsonSafe<T>(res: Response): Promise<T | any> { parseJsonSafe", "description": "Safely parses JSON from a Response object, returning text if JSON parsing fails.", "scope": "", "scopeKind": ""}, {"name": "async function doFetch<T>( doFetch", "description": "Performs the HTTP request with automatic handling of authorization, retries on 401, and error normalization.", "scope": "", "scopeKind": ""}, {"name": "export function configureAuth(integration: AuthIntegration): void { configureAuth", "description": "Configures the authentication integration including token retrieval, refresh, and handling unauthorized responses.", "scope": "", "scopeKind": ""}, {"name": "export function deriveWsBase(): string { deriveWsBase", "description": "Derives the WebSocket base URL based on environment variables or fallback logic.", "scope": "", "scopeKind": ""}], "calls": ["fetch", "JSON.parse", "URL", "Object.entries", "Array.prototype.forEach"], "search-terms": ["http client wrapper", "token refresh", "configureAuth", "VITE_API_BASE", "VITE_WS_URL", "fetch wrapper"], "state": 2, "file_id": 53, "knowledge_revision": 153, "git_revision": "", "ctags": [{"_type": "tag", "name": "AuthIntegration", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^type AuthIntegration = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "apiBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const apiBase = (import.meta?.env?.VITE_API_BASE || '').replace(\\/\\\\\\/$\\/, '');$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "auth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = auth.getAccessToken ? auth.getAccessToken() : null;$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "auth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let auth: AuthIntegration = {};$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const base = (import.meta?.env?.VITE_API_BASE || '').replace(\\/\\\\\\/$\\/, '');$/", "language": "TypeScript", "kind": "constant", "scope": "buildUrl", "scopeKind": "function"}, {"_type": "tag", "name": "buildUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function buildUrl(path: string, query?: Record<string, unknown>): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "configureAuth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function configureAuth(integration: AuthIntegration): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "contentType", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const contentType = res.headers.get('Content-Type') || '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^      const current = new URL(window.location.origin);$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "deriveWsBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function deriveWsBase(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "doFetch", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function doFetch<T>($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "errBody", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const errBody = await parseJsonSafe<any>(res);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const error = new Error(message);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const headers: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "http", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export const http = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const message =$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^      const ok = await auth.refresh();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "parseJsonSafe", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function parseJsonSafe<T>(res: Response): Promise<T | any> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "parseJsonSafe", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const text = await res.text();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = auth.getAccessToken ? auth.getAccessToken() : null;$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const u = new URL(apiBase || window.location.origin);$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const u = new URL(path);$/", "language": "TypeScript", "kind": "constant", "scope": "buildUrl", "scopeKind": "function"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const u = new URL(`${base}\\/${path.replace(\\/^\\\\\\/\\/, '')}`);$/", "language": "TypeScript", "kind": "constant", "scope": "buildUrl", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const url = buildUrl(path, query);$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "wsEnv", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const wsEnv = import.meta?.env?.VITE_WS_URL;$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}], "hash": "6321b23d15566d0f58ded20dc8e98109", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/http.ts", "fields": [{"name": "let auth: AuthIntegration = {};", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"153": ""}]}