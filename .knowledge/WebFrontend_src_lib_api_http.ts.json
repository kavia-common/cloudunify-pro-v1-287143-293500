{"is_source_file": true, "format": "TypeScript", "description": "This file provides an API utility module for making HTTP requests with support for authentication, error handling, and debugging. It includes functions to configure authentication behavior, perform GET and POST requests with JSON payloads, and handle token refresh and unauthorized responses.", "external_files": ["./fetchDebug"], "external_methods": ["setFetchDebugStatus"], "published": ["configureAuth", "getJson", "postJson"], "classes": [{"name": "HttpError", "description": "A custom error type extending Error to include HTTP status and body information."}], "methods": [{"name": "export function configureAuth(cfg: AuthConfig): void { configureAuth", "description": "Sets the global authentication configuration to handle token management and unauthorized callbacks.", "scope": "", "scopeKind": ""}, {"name": "export async function getJson<T>(url: string, opts: RequestOptions = {}): Promise<T> { getJson", "description": "Performs a GET request expecting a JSON response, with optional soft 401 handling.", "scope": "", "scopeKind": ""}, {"name": "export async function postJson<T>(url: string, body: unknown, opts: RequestOptions = {}): Promis/ postJson", "description": "Performs a POST request with a JSON body, processing the JSON response and fallback handling.", "scope": "", "scopeKind": ""}, {"name": "function buildError(status: number, message: string, body?: unknown): HttpError { buildError", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function doFetch(url: string, init: RequestInit, opts: RequestOptions = {}, attempt = 0): / doFetch", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function safeReadText(res: Response): Promise<string> { safeReadText", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetch", "setFetchDebugStatus", "authConfig?.getAccessToken", "authConfig?.refresh", "authConfig.onUnauthorized", "safeReadText"], "search-terms": ["HTTP request utility", "TypeScript fetch wrapper", "authentication configuration", "token refresh", "HTTP error handling"], "state": 2, "file_id": 75, "knowledge_revision": 261, "git_revision": "", "ctags": [{"_type": "tag", "name": "AuthConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^type AuthConfig = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "HttpError", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export type HttpError = Error & { status?: number; body?: unknown };$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "RequestOptions", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^type RequestOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "authConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let authConfig: AuthConfig | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "buildError", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function buildError(status: number, message: string, body?: unknown): HttpError {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "configureAuth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function configureAuth(cfg: AuthConfig): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "contentType", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const contentType = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "postJson", "scopeKind": "function"}, {"_type": "tag", "name": "doFetch", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function doFetch(url: string, init: RequestInit, opts: RequestOptions = {}, attempt = 0): /", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "e", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const e = new Error(message) as HttpError;$/", "language": "TypeScript", "kind": "constant", "scope": "buildError", "scopeKind": "function"}, {"_type": "tag", "name": "getJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export async function getJson<T>(url: string, opts: RequestOptions = {}): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const headers = new Headers(init.headers || {});$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "null", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = authConfig?.getAccessToken?.() ?? null;$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "postJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export async function postJson<T>(url: string, body: unknown, opts: RequestOptions = {}): Promis/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "refreshed", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const refreshed = await authConfig.refresh();$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await doFetch($/", "language": "TypeScript", "kind": "constant", "scope": "postJson", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await doFetch(url, { method: 'GET' }, opts);$/", "language": "TypeScript", "kind": "constant", "scope": "getJson", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await fetch(url, { ...init, headers });$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "safeReadText", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function safeReadText(res: Response): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const text = await safeReadText(res);$/", "language": "TypeScript", "kind": "constant", "scope": "getJson", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const text = await safeReadText(res);$/", "language": "TypeScript", "kind": "constant", "scope": "postJson", "scopeKind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = authConfig?.getAccessToken?.() ?? null;$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}], "hash": "6959aa6b2e3cf02e5187be29b3e95cb1", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/http.ts", "fields": [{"name": "let authConfig: AuthConfig | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"261": ""}]}