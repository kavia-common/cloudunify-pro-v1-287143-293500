{"is_source_file": true, "format": "TypeScript", "description": "This file implements a minimal JSON HTTP client for the WebFrontend, providing functions for making authenticated HTTP requests, handling refresh tokens, and managing unauthorized responses. It includes configuration for authorization, request handling, error parsing, and logging.", "external_files": ["fetch API (built-in browser API)", "import.meta (for environment variables)"], "external_methods": ["fetch"], "published": ["configureAuth", "requestJson", "getJson", "postJson"], "classes": [], "methods": [{"name": "export function configureAuth(config: AuthConfig): void { configureAuth", "description": "Configures how HTTP requests should attach auth tokens and handle 401 refresh/unauthorized flows.", "scope": "", "scopeKind": ""}, {"name": "export async function requestJson<T>(opts: RequestOptions): Promise<T> { requestJson", "description": "Performs an authenticated JSON request with retry logic on 401 status, attempting token refresh before retry.", "scope": "", "scopeKind": ""}, {"name": "export async function getJson<T>(url: string): Promise<T> { getJson", "description": "Convenience function for making GET requests that expect JSON responses.", "scope": "", "scopeKind": ""}, {"name": "export async function postJson<T>(url: string, body: unknown): Promise<T> { postJson", "description": "Convenience function for making POST requests with JSON bodies.", "scope": "", "scopeKind": ""}, {"name": "function debugLog(...args: any[]): void { debugLog", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function doFetch<T>(opts: RequestOptions): Promise<T> { doFetch", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function isInUnauthorizedGraceWindow(): boolean { isInUnauthorizedGraceWindow", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function parseErrorMessage(res: Response): Promise<string> { parseErrorMessage", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetch", "parseErrorMessage", "doFetch", "authConfig.getAccessToken", "authConfig.refresh", "authConfig.onUnauthorized", "isInUnauthorizedGraceWindow"], "search-terms": ["HTTP client", "fetch API", "authorization header", "refresh token", "unauthorized retry", "json request", "typescript api"], "state": 2, "file_id": 58, "knowledge_revision": 198, "git_revision": "", "revision_history": [{"176": ""}, {"180": ""}, {"198": ""}], "ctags": [{"_type": "tag", "name": "AuthConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export type AuthConfig = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "JsonPrimitive", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^type JsonPrimitive = string | number | boolean | null;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "JsonValue", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export type JsonValue = JsonPrimitive | JsonValue[] | { [key: string]: JsonValue };$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "RequestOptions", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export type RequestOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "UNAUTHORIZED_GRACE_MS", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^const UNAUTHORIZED_GRACE_MS = 1500;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "authConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let authConfig: AuthConfig = {$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "clientBootTs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^const clientBootTs = Date.now();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "configureAuth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function configureAuth(config: AuthConfig): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const ct = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorMessage", "scopeKind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const ct = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "debugLog", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function debugLog(...args: any[]): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "doFetch", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function doFetch<T>(opts: RequestOptions): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "err", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const err = new Error(`${res.status} ${res.statusText}${msg ? `: ${msg}` : ''}`);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "getJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export async function getJson<T>(url: string): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const headers: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "isInUnauthorizedGraceWindow", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function isInUnauthorizedGraceWindow(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "j", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^      const j = (await res.json()) as any;$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorMessage", "scopeKind": "function"}, {"_type": "tag", "name": "lvl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const lvl = (import.meta as any)?.env?.REACT_APP_LOG_LEVEL || (import.meta as any)?.env?.VIT/", "language": "TypeScript", "kind": "constant", "scope": "debugLog", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const msg = await parseErrorMessage(res);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const ok = await authConfig.refresh();$/", "language": "TypeScript", "kind": "constant", "scope": "requestJson", "scopeKind": "function"}, {"_type": "tag", "name": "parseErrorMessage", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function parseErrorMessage(res: Response): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "postJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export async function postJson<T>(url: string, body: unknown): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "requestJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export async function requestJson<T>(opts: RequestOptions): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await fetch(opts.url, {$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const status = e?.status;$/", "language": "TypeScript", "kind": "constant", "scope": "requestJson", "scopeKind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const t = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorMessage", "scopeKind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = authConfig.getAccessToken();$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}], "hash": "51b7aae0258d3b6fe02187dd88bed766", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/http.ts", "fields": [{"name": "let authConfig: AuthConfig = {", "scope": "", "scopeKind": "", "description": "unavailable"}]}