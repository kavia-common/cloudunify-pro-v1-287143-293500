{"is_source_file": true, "format": "TypeScript", "description": "This file provides an HTTP client utility module for a web frontend application, including functions to perform HTTP requests, URL building, token-based authentication handling, and WebSocket URL derivation.", "external_files": ["import.meta"], "external_methods": ["fetch"], "published": ["configureAuth", "http", "deriveWsBase"], "classes": [], "methods": [{"name": "function buildApiUrl(path: string, query?: Record<string, unknown>): string { buildApiUrl", "description": "Constructs an absolute URL for API request, considering environment base URL, input path, and query parameters.", "scope": "", "scopeKind": ""}, {"name": "async function parseJsonSafe<T>(res: Response): Promise<T | any> { parseJsonSafe", "description": "Safely parses the response text as JSON, returning raw text if parsing fails.", "scope": "", "scopeKind": ""}, {"name": "async function doFetch<T>( doFetch", "description": "Performs an HTTP request with automatic handling of authorization tokens, token refresh, and error handling.", "scope": "", "scopeKind": ""}, {"name": "export function configureAuth(integration: AuthIntegration): void { configureAuth", "description": "Configures authentication token retrieval and refresh mechanisms.", "scope": "", "scopeKind": ""}, {"name": "http.get", "description": "Performs a GET request to the specified API path."}, {"name": "http.post", "description": "Performs a POST request with JSON body."}, {"name": "http.put", "description": "Performs a PUT request with JSON body."}, {"name": "http.delete", "description": "Performs a DELETE request."}, {"name": "export function deriveWsBase(): string { deriveWsBase", "description": "Derives a WebSocket base URL from environment variables or defaults.", "scope": "", "scopeKind": ""}, {"name": "function getOrigin(): string { getOrigin", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function getSanitizedApiBase(): string | null { getSanitizedApiBase", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function isAbsoluteUrl(v: string): boolean { isAbsoluteUrl", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function joinPaths(a: string, b: string): string { joinPaths", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["isAbsoluteUrl", "getOrigin", "getSanitizedApiBase", "buildApiUrl", "fetch", "parseJsonSafe", "auth.getAccessToken", "auth.refresh", "auth.onUnauthorized"], "search-terms": ["http client", "API URL builder", "fetch wrapper", "token refresh logic", "WebSocket URL derivation", "TypeScript API utils"], "state": 2, "file_id": 53, "knowledge_revision": 162, "git_revision": "", "revision_history": [{"153": ""}, {"162": ""}], "ctags": [{"_type": "tag", "name": "AuthIntegration", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^type AuthIntegration = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "abs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const abs = new URL(inputPath);$/", "language": "TypeScript", "kind": "constant", "scope": "buildApiUrl", "scopeKind": "function"}, {"_type": "tag", "name": "apiBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const apiBase = getSanitizedApiBase();$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "auth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = auth.getAccessToken ? auth.getAccessToken() : null;$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "auth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^let auth: AuthIntegration = {};$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const base = apiBase || getOrigin();$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "buildApiUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function buildApiUrl(path: string, query?: Record<string, unknown>): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "configureAuth", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function configureAuth(integration: AuthIntegration): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "contentType", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const contentType = res.headers.get('Content-Type') || '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^      const current = new URL(getOrigin());$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "deriveWsBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export function deriveWsBase(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "doFetch", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function doFetch<T>($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "envBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const envBase = getSanitizedApiBase();$/", "language": "TypeScript", "kind": "constant", "scope": "buildApiUrl", "scopeKind": "function"}, {"_type": "tag", "name": "errBody", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const errBody = await parseJsonSafe<any>(res);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const error = new Error(message);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "getOrigin", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function getOrigin(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getSanitizedApiBase", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function getSanitizedApiBase(): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const headers: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "http", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^export const http = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "inputPath", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const inputPath = (path || '').trim() || '\\/';$/", "language": "TypeScript", "kind": "constant", "scope": "buildApiUrl", "scopeKind": "function"}, {"_type": "tag", "name": "isAbsoluteUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function isAbsoluteUrl(v: string): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "joinPaths", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^function joinPaths(a: string, b: string): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "left", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const left = (a || '').replace(\\/\\\\\\/+$\\/, '');$/", "language": "TypeScript", "kind": "constant", "scope": "joinPaths", "scopeKind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const message =$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^      const ok = await auth.refresh();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "parseJsonSafe", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^async function parseJsonSafe<T>(res: Response): Promise<T | any> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "prefixed", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const prefixed = joinPaths('\\/api\\/v1', inputPath);$/", "language": "TypeScript", "kind": "constant", "scope": "buildApiUrl", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const raw: unknown = (import.meta as any)?.env?.VITE_API_BASE;$/", "language": "TypeScript", "kind": "constant", "scope": "getSanitizedApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "right", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const right = (b || '').replace(\\/^\\\\\\/+\\/, '');$/", "language": "TypeScript", "kind": "constant", "scope": "joinPaths", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "parseJsonSafe", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const text = await res.text();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const token = auth.getAccessToken ? auth.getAccessToken() : null;$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "trimmed", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const trimmed = raw.trim();$/", "language": "TypeScript", "kind": "constant", "scope": "getSanitizedApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^    const u = new URL(base);$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const url = buildApiUrl(path, query);$/", "language": "TypeScript", "kind": "constant", "scope": "doFetch", "scopeKind": "function"}, {"_type": "tag", "name": "wsEnv", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/http.ts", "pattern": "/^  const wsEnv: unknown = (import.meta as any)?.env?.VITE_WS_URL;$/", "language": "TypeScript", "kind": "constant", "scope": "deriveWsBase", "scopeKind": "function"}], "hash": "ce864e59ebc5f597ec31b69511bf2f0c", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/http.ts", "fields": [{"name": "let auth: AuthIntegration = {};", "scope": "", "scopeKind": "", "description": "unavailable"}]}