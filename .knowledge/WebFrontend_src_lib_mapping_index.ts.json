{"is_source_file": true, "format": "TypeScript", "description": "This file contains utility functions and types for parsing and validating resource and cost data files (CSV/XLSX) within a web frontend project, including normalization, validation, and file reading logic.", "external_files": ["papaparse", "xlsx"], "external_methods": ["Papa.parse", "XLSX.read", "XLSX.utils.sheet_to_json"], "published": ["parseResourceFile", "parseCostFile", "ResourceIngestRow", "CostIngestRow", "ParseResult"], "classes": [], "methods": [{"name": "function normalizeHeader(h: string): string { normalizeHeader", "description": "Converts header string to a normalized form (lowercase, underscores, alphanumeric).", "scope": "", "scopeKind": ""}, {"name": "function normalizeKeys<T extends GenericRecord>(row: GenericRecord): T { normalizeKeys", "description": "Normalizes all keys in a record to a standard format.", "scope": "", "scopeKind": ""}, {"name": "async function readCsvText(file: File): Promise<string> { readCsvText", "description": "Reads CSV file content as text.", "scope": "", "scopeKind": ""}, {"name": "function parseCsvRows<T extends GenericRecord>(text: string): T[] { parseCsvRows", "description": "Parses CSV text into an array of records with normalized headers.", "scope": "", "scopeKind": ""}, {"name": "async function parseExcelRows<T extends GenericRecord>(file: File): Promise<T[]> { parseExcelRows", "description": "Parses Excel file into an array of records with normalized keys.", "scope": "", "scopeKind": ""}, {"name": "async function readRows<T extends GenericRecord>(file: File): Promise<T[]> { readRows", "description": "Determines file type based on extension and reads rows accordingly.", "scope": "", "scopeKind": ""}, {"name": "function ensureNumber(v: any): number | undefined { ensureNumber", "description": "Converts a value to a finite number if possible.", "scope": "", "scopeKind": ""}, {"name": "function validateResourceRow(row: ResourceIngestRow): string[] { validateResourceRow", "description": "Validates resource row data for required fields and correct types.", "scope": "", "scopeKind": ""}, {"name": "function validateCostRow(row: CostIngestRow): string[] { validateCostRow", "description": "Validates cost row data for required fields and correct value ranges.", "scope": "", "scopeKind": ""}, {"name": "export async function parseResourceFile(file: File): Promise<ParseResult<ResourceIngestRow>> { parseResourceFile", "description": "Public function to parse resource files with validation, returning structured result.", "scope": "", "scopeKind": ""}, {"name": "export async function parseCostFile(file: File): Promise<ParseResult<CostIngestRow>> { parseCostFile", "description": "Public function to parse cost files with validation, returning structured result.", "scope": "", "scopeKind": ""}], "calls": ["readCsvText", "parseCsvRows", "parseExcelRows", "normalizeKeys", "validateResourceRow", "validateCostRow"], "search-terms": ["parseResourceFile", "parseCostFile", "normalizeHeader", "ResourceIngestRow", "CostIngestRow", "CSV parsing", "Excel parsing", "file normalization", "validation"], "state": 2, "file_id": 55, "knowledge_revision": 155, "git_revision": "", "ctags": [{"_type": "tag", "name": "CostIngestRow", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export type CostIngestRow = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "GenericRecord", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export type GenericRecord = Record<string, any>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ParseResult", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export type ParseResult<T extends GenericRecord> = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ParsedInvalidRow", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export type ParsedInvalidRow = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "ResourceIngestRow", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export type ResourceIngestRow = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "amt", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const amt = ensureNumber(row.amount ?? row.cost);$/", "language": "TypeScript", "kind": "constant", "scope": "parseCostFile", "scopeKind": "function"}, {"_type": "tag", "name": "amt", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const amt = ensureNumber(row.amount ?? row.cost);$/", "language": "TypeScript", "kind": "constant", "scope": "validateCostRow", "scopeKind": "function"}, {"_type": "tag", "name": "buf", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const buf = await file.arrayBuffer();$/", "language": "TypeScript", "kind": "constant", "scope": "parseExcelRows", "scopeKind": "function"}, {"_type": "tag", "name": "cd", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^      const cd = ensureNumber(row.cost_daily);$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "cd", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const cd = ensureNumber(row.cost_daily);$/", "language": "TypeScript", "kind": "constant", "scope": "validateResourceRow", "scopeKind": "function"}, {"_type": "tag", "name": "cm", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^      const cm = ensureNumber(row.cost_monthly);$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "cm", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const cm = ensureNumber(row.cost_monthly);$/", "language": "TypeScript", "kind": "constant", "scope": "validateResourceRow", "scopeKind": "function"}, {"_type": "tag", "name": "ensureNumber", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^function ensureNumber(v: any): number | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const errors = validateCostRow(row);$/", "language": "TypeScript", "kind": "constant", "scope": "parseCostFile", "scopeKind": "function"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const errors = validateResourceRow(row);$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const errors: string[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "validateCostRow", "scopeKind": "function"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const errors: string[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "validateResourceRow", "scopeKind": "function"}, {"_type": "tag", "name": "fallback", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const fallback = await readCsvText(file);$/", "language": "TypeScript", "kind": "constant", "scope": "readRows", "scopeKind": "function"}, {"_type": "tag", "name": "first", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const first = wb.SheetNames[0];$/", "language": "TypeScript", "kind": "constant", "scope": "parseExcelRows", "scopeKind": "function"}, {"_type": "tag", "name": "first", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const ws = wb.Sheets[first];$/", "language": "TypeScript", "kind": "constant", "scope": "parseExcelRows", "scopeKind": "function"}, {"_type": "tag", "name": "invalidRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const invalidRows: ParsedInvalidRow[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "parseCostFile", "scopeKind": "function"}, {"_type": "tag", "name": "invalidRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const invalidRows: ParsedInvalidRow[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const n = Number(v);$/", "language": "TypeScript", "kind": "constant", "scope": "ensureNumber", "scopeKind": "function"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const name = (file.name || '').toLowerCase();$/", "language": "TypeScript", "kind": "constant", "scope": "readRows", "scopeKind": "function"}, {"_type": "tag", "name": "nk", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const nk = normalizeHeader(String(k));$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeKeys", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeHeader", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^function normalizeHeader(h: string): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "normalizeKeys", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^function normalizeKeys<T extends GenericRecord>(row: GenericRecord): T {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "out", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const out: GenericRecord = {};$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeKeys", "scopeKind": "function"}, {"_type": "tag", "name": "parseCostFile", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export async function parseCostFile(file: File): Promise<ParseResult<CostIngestRow>> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parseCsvRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^function parseCsvRows<T extends GenericRecord>(text: string): T[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parseExcelRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^async function parseExcelRows<T extends GenericRecord>(file: File): Promise<T[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parseResourceFile", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^export async function parseResourceFile(file: File): Promise<ParseResult<ResourceIngestRow>> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const raw = XLSX.utils.sheet_to_json<GenericRecord>(ws, { raw: false });$/", "language": "TypeScript", "kind": "constant", "scope": "parseExcelRows", "scopeKind": "function"}, {"_type": "tag", "name": "readCsvText", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^async function readCsvText(file: File): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "readRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^async function readRows<T extends GenericRecord>(file: File): Promise<T[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const result = Papa.parse<T>(text, {$/", "language": "TypeScript", "kind": "constant", "scope": "parseCsvRows", "scopeKind": "function"}, {"_type": "tag", "name": "row", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const row = normalizeKeys<CostIngestRow>(r);$/", "language": "TypeScript", "kind": "constant", "scope": "parseCostFile", "scopeKind": "function"}, {"_type": "tag", "name": "row", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const row = normalizeKeys<ResourceIngestRow>(r);$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const rows = (result?.data || []) as unknown as T[];$/", "language": "TypeScript", "kind": "constant", "scope": "parseCsvRows", "scopeKind": "function"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const rows = await readRows<CostIngestRow>(file);$/", "language": "TypeScript", "kind": "constant", "scope": "parseCostFile", "scopeKind": "function"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const rows = await readRows<ResourceIngestRow>(file);$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^    const text = await readCsvText(file);$/", "language": "TypeScript", "kind": "constant", "scope": "readRows", "scopeKind": "function"}, {"_type": "tag", "name": "validRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const validRows: CostIngestRow[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "parseCostFile", "scopeKind": "function"}, {"_type": "tag", "name": "validRows", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const validRows: ResourceIngestRow[] = [];$/", "language": "TypeScript", "kind": "constant", "scope": "parseResourceFile", "scopeKind": "function"}, {"_type": "tag", "name": "validateCostRow", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^function validateCostRow(row: CostIngestRow): string[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "validateResourceRow", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^function validateResourceRow(row: ResourceIngestRow): string[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "wb", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const wb = XLSX.read(buf);$/", "language": "TypeScript", "kind": "constant", "scope": "parseExcelRows", "scopeKind": "function"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/mapping/index.ts", "pattern": "/^  const ws = wb.Sheets[first];$/", "language": "TypeScript", "kind": "constant", "scope": "parseExcelRows", "scopeKind": "function"}], "hash": "85a60bdafaf6d61c9c6c6ddd261b32ea", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/mapping/index.ts", "revision_history": [{"155": ""}]}