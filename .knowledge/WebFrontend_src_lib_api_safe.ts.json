{"is_source_file": true, "format": "TypeScript", "description": "This file provides utility functions for making resilient HTTP fetch requests with features like timeout, retries, debug recording, and handling specific status cases. It exports the safeGetJson function for fetching JSON data safely, along with related types and helpers.", "external_files": ["../authMode", "./fetchDebug"], "external_methods": ["isAuthDisabled", "isFetchDebugEnabled", "setFetchDebugStatus"], "published": ["SafeFetchOptions", "SafeFetchResult", "safeGetJson"], "classes": [], "methods": [{"name": "function sleep(ms: number): Promise<void> { sleep", "description": "Pauses execution for a specified number of milliseconds.", "scope": "", "scopeKind": ""}, {"name": "function jitter(ms: number): number { jitter", "description": "Returns a jittered (randomized) variant of the input time, with +/- 20% jitter.", "scope": "", "scopeKind": ""}, {"name": "async function parseErrorBody(res: Response): Promise<string> { parseErrorBody", "description": "Parses the error body from a Response object, prioritizing JSON with message, detail, or error fields.", "scope": "", "scopeKind": ""}, {"name": "function recordDebugStatus(input: { recordDebugStatus", "description": "Records fetch request status for debugging purposes if enabled.", "scope": "", "scopeKind": ""}, {"name": "function devWarn(...args: any[]): void { devWarn", "description": "Logs warnings during development/testing when fetch debug is enabled.", "scope": "", "scopeKind": ""}, {"name": "export async function safeGetJson<T>(url: string, opts: SafeFetchOptions = {}): Promise<SafeFetc/ safeGetJson", "description": "Fetches JSON data from a given URL with resilience features: timeout, retries, special handling for 401 status when auth is disabled, and debug recording.", "scope": "", "scopeKind": ""}], "calls": ["fetch", "window.setTimeout", "window.clearTimeout", "JSON.parse", "res.json()", "res.text()", "res.headers.get"], "search-terms": ["resilient fetch", "timeout retries fetch", "fetch debug banner", "safe HTTP request", "fetch JSON with retries", "fetch timeout", "auth disabled fetch"], "state": 2, "file_id": 66, "knowledge_revision": 224, "git_revision": "", "revision_history": [{"220": ""}, {"224": ""}], "ctags": [{"_type": "tag", "name": "SafeFetchOptions", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^export type SafeFetchOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SafeFetchResult", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^export type SafeFetchResult<T> =$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "controller", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const controller = new AbortController();$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const ct = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const ct = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorBody", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const data = (await res.json()) as T;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "delta", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const delta = ms * 0.2;$/", "language": "TypeScript", "kind": "constant", "scope": "jitter", "scopeKind": "function"}, {"_type": "tag", "name": "devWarn", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^function devWarn(...args: any[]): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "isAbort", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const isAbort = e?.name === 'AbortError';$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "j", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const j = (await res.json()) as any;$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorBody", "scopeKind": "function"}, {"_type": "tag", "name": "jitter", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^function jitter(ms: number): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const message = isAbort ? 'Request timed out' : String(e?.message || 'Network error');$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const msg = await parseErrorBody(res);$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "parseErrorBody", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^async function parseErrorBody(res: Response): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const parsed = JSON.parse(text) as T;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "recordDebugStatus", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^function recordDebugStatus(input: {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "retries", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const retries = opts.retries ?? 1;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "retryDelayMs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const retryDelayMs = opts.retryDelayMs ?? 350;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "safeGetJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^export async function safeGetJson<T>(url: string, opts: SafeFetchOptions = {}): Promise<SafeFetc/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "shouldRetry", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const shouldRetry = res.status >= 500 || res.status === 429;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "sleep", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^function sleep(ms: number): Promise<void> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const t = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorBody", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "timeoutMs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const timeoutMs = opts.timeoutMs ?? 8000;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "timer", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const timer = window.setTimeout(() => controller.abort(), timeoutMs);$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}], "hash": "7e8f2e6f64ab352b169dea8938478a59", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/safe.ts"}