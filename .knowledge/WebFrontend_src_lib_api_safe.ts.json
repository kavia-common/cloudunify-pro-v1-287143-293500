{"is_source_file": true, "format": "TypeScript", "description": "A utility module providing safe and resilient fetch helpers with timeout, retry, and error handling tailored for dashboard widgets/pages. It includes types for fetch options and results, functions for sleep and jitter, error parsing, and a public interface function `safeGetJson` to perform robust JSON fetches.", "external_files": ["../authMode"], "external_methods": ["isAuthDisabled"], "published": ["SafeFetchOptions", "SafeFetchResult", "safeGetJson"], "classes": [], "methods": [{"name": "function sleep(ms: number): Promise<void> { sleep", "description": "Pauses execution for a specified number of milliseconds.", "scope": "", "scopeKind": ""}, {"name": "function jitter(ms: number): number { jitter", "description": "Calculates a jittered delay with \u00b120% randomness.", "scope": "", "scopeKind": ""}, {"name": "async function parseErrorBody(res: Response): Promise<string> { parseErrorBody", "description": "Parses the error response body to extract a message, handling JSON and text content types.", "scope": "", "scopeKind": ""}, {"name": "export async function safeGetJson<T>(url: string, opts: SafeFetchOptions = {}): Promise<SafeFetc/ safeGetJson", "description": "Performs a resilient fetch request for JSON, with timeout, retries, and special handling for 401 responses when auth is disabled.", "scope": "", "scopeKind": ""}], "calls": ["fetch", "parseErrorBody", "isAuthDisabled", "sleep", "jitter", "window.setTimeout", "window.clearTimeout"], "search-terms": ["resilient fetch", "timeout retries fetch", "safeGetJson", "fetch with backoff", "json fetch utility", "auth disabled 401 handling"], "state": 2, "file_id": 66, "knowledge_revision": 220, "git_revision": "", "ctags": [{"_type": "tag", "name": "SafeFetchOptions", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^export type SafeFetchOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SafeFetchResult", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^export type SafeFetchResult<T> =$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "controller", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const controller = new AbortController();$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const ct = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const ct = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorBody", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const data = (await res.json()) as T;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "delta", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const delta = ms * 0.2;$/", "language": "TypeScript", "kind": "constant", "scope": "jitter", "scopeKind": "function"}, {"_type": "tag", "name": "isAbort", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const isAbort = e?.name === 'AbortError';$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "j", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const j = (await res.json()) as any;$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorBody", "scopeKind": "function"}, {"_type": "tag", "name": "jitter", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^function jitter(ms: number): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const message = isAbort ? 'Request timed out' : String(e?.message || 'Network error');$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const msg = await parseErrorBody(res);$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "parseErrorBody", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^async function parseErrorBody(res: Response): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "retries", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const retries = opts.retries ?? 1;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "retryDelayMs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const retryDelayMs = opts.retryDelayMs ?? 350;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "safeGetJson", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^export async function safeGetJson<T>(url: string, opts: SafeFetchOptions = {}): Promise<SafeFetc/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "shouldRetry", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^        const shouldRetry = res.status >= 500 || res.status === 429;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "sleep", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^function sleep(ms: number): Promise<void> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const t = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "parseErrorBody", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^      const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "timeoutMs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^  const timeoutMs = opts.timeoutMs ?? 8000;$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}, {"_type": "tag", "name": "timer", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-v1-287143-293500/WebFrontend/src/lib/api/safe.ts", "pattern": "/^    const timer = window.setTimeout(() => controller.abort(), timeoutMs);$/", "language": "TypeScript", "kind": "constant", "scope": "safeGetJson", "scopeKind": "function"}], "hash": "63e71e00504c262caad78fa46358fe45", "format-version": 4, "code-base-name": "WebFrontend", "filename": "WebFrontend/src/lib/api/safe.ts", "revision_history": [{"220": ""}]}